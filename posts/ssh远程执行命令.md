---
title: ssh远程执行命令
date: 2017-12-08 23:49:08
tags: ssh
---
最近在部署一个对等集群,由于集群没接入统一的自动部署平台,而手工一台台部署又太累了,所以写了个自动部署的脚本，主要使用了
scp命令来复制jar包和ssh远程执行命令，期间遇到了几个坑，记录下。

## 1. ssh Pseudo-terminal will not be allocated because stdin is not a terminal.
字面意思就是stdin不是terminal,无法分配伪终端。

apue里有讲,从内核角度看，伪终端看起来像一个双向管道，而事实上Solaris的伪终端就是用STREAMS构建的。伪终端总是成对地使用的，就好像是个管道的两端。一端的设备称为"主设备"(master)，另一端的设备称为"从设备"(slave)，每一对伪终端设备，例如/dev/ptys0和/dev/ttys0，就好像是通过一个管道连在一起，其"从设备"一端与普通的终端设备没有什么区别，而"主设备"一端则跟管道文件相似。

回到这个问题,我们有两种解决方式,强制分配伪终端和直接跳过请求分配伪终端。
分别对应`-t-t`命令和-T指令,在我们的部署脚本里,由于不需要终端交互,所以直接用-T就可以了。

## 2. ssh 执行带命令
1. 带参数
```
'bash -s' 
```

2. 重定向远程输出到本地
```
<
```

3. 如果执行脚本,需要指定脚本的绝对路径,不能使用相对路径。
